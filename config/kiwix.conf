# Enhanced Kiwix Server Configuration for Comprehensive Offline Knowledge
# Includes all major sources used in Prepper Disk, Internet-in-a-Box, etc.

KIWIX_PORT=8080
KIWIX_DATA_DIR="/opt/prepperpi/data/kiwix"
KIWIX_LIBRARY_FILE="/opt/prepperpi/data/library.xml"
AUTO_UPDATE=true
UPDATE_SCHEDULE="monthly"  # Changed to monthly due to large file sizes

# =============================================================================
# CORE KIWIX/WIKIMEDIA SOURCES
# =============================================================================

# Wikipedia - Multiple languages and sizes
WIKIPEDIA_SOURCES=(
    # English Wikipedia (choose one based on storage)
    "https://download.kiwix.org/zim/wikipedia/wikipedia_en_all_maxi_2024-01.zim"        # ~95GB - Complete
    # "https://download.kiwix.org/zim/wikipedia/wikipedia_en_all_nopic_2024-01.zim"     # ~20GB - No images
    # "https://download.kiwix.org/zim/wikipedia/wikipedia_en_top_2024-01.zim"           # ~15GB - Top articles only
    
    # Other languages (uncomment as needed)
    # "https://download.kiwix.org/zim/wikipedia/wikipedia_es_all_maxi_2024-01.zim"      # Spanish
    # "https://download.kiwix.org/zim/wikipedia/wikipedia_fr_all_maxi_2024-01.zim"      # French
    # "https://download.kiwix.org/zim/wikipedia/wikipedia_de_all_maxi_2024-01.zim"      # German
    # "https://download.kiwix.org/zim/wikipedia/wikipedia_ar_all_maxi_2024-01.zim"      # Arabic
)

# Wikimedia Sister Projects
WIKIMEDIA_SOURCES=(
    # Travel and geography
    "https://download.kiwix.org/zim/wikivoyage/wikivoyage_en_all_maxi_2024-01.zim"      # Travel guides
    
    # Dictionaries and references
    "https://download.kiwix.org/zim/wiktionary/wiktionary_en_all_maxi_2024-01.zim"      # English dictionary
    
    # Educational content
    "https://download.kiwix.org/zim/wikibooks/wikibooks_en_all_maxi_2024-01.zim"        # Educational books
    "https://download.kiwix.org/zim/wikiversity/wikiversity_en_all_maxi_2024-01.zim"    # Learning resources
    
    # News and current events
    "https://download.kiwix.org/zim/wikinews/wikinews_en_all_maxi_2024-01.zim"          # News archive
    
    # How-to guides
    "https://download.kiwix.org/zim/wikihow/wikihow_en_maxi_2024-01.zim"                # WikiHow guides
)

# =============================================================================
# MEDICAL AND HEALTH SOURCES
# =============================================================================

MEDICAL_SOURCES=(
    # WikiMed - Curated medical content from Wikipedia
    "https://download.kiwix.org/zim/wikimed/wikimed_en_all_2024-01.zim"
    
    # MSD Manuals (if available as ZIM)
    # "https://download.kiwix.org/zim/msdmanuals/msdmanuals_en_2024-01.zim"
    
    # WHO resources (if available as ZIM)
    # "https://download.kiwix.org/zim/who/who_en_2024-01.zim"
    
    # Medical Wikipedia alternative
    "https://download.kiwix.org/zim/wikipedia/wikipedia_en_medicine_2024-01.zim"
)

# =============================================================================
# LITERATURE AND BOOKS
# =============================================================================

LITERATURE_SOURCES=(
    # Project Gutenberg - Public domain books
    "https://download.kiwix.org/zim/gutenberg/gutenberg_en_all_2023-08.zim"             # ~70GB - All books
    # "https://download.kiwix.org/zim/gutenberg/gutenberg_en_selection_2023-08.zim"     # ~4GB - Selection only
    
    # Internet Archive Books
    # "https://download.kiwix.org/zim/archive/archive_books_2024-01.zim"
)

# =============================================================================
# TECHNICAL AND REFERENCE SOURCES
# =============================================================================

TECHNICAL_SOURCES=(
    # Stack Exchange family
    "https://download.kiwix.org/zim/stack_exchange/stackoverflow.com_en_all_2024-01.zim"
    "https://download.kiwix.org/zim/stack_exchange/askubuntu.com_en_all_2024-01.zim"
    "https://download.kiwix.org/zim/stack_exchange/superuser.com_en_all_2024-01.zim"
    "https://download.kiwix.org/zim/stack_exchange/serverfault.com_en_all_2024-01.zim"
    
    # Reddit communities (if available)
    # "https://download.kiwix.org/zim/reddit/reddit_preppers_2024-01.zim"
    # "https://download.kiwix.org/zim/reddit/reddit_homesteading_2024-01.zim"
)

# =============================================================================
# EDUCATIONAL SOURCES
# =============================================================================

EDUCATIONAL_SOURCES=(
    # Khan Academy
    "https://download.kiwix.org/zim/khan-academy/khan-academy_en_2024-01.zim"
    
    # TED Talks
    "https://download.kiwix.org/zim/ted/ted_en_2024-01.zim"
    
    # Coursera content (if available)
    # "https://download.kiwix.org/zim/coursera/coursera_selection_2024-01.zim"
)

# =============================================================================
# SURVIVAL AND PREPAREDNESS SOURCES  
# =============================================================================

SURVIVAL_SOURCES=(
    # Note: These are typically PDFs, not ZIM files
    # They would be handled separately in the PDF management section
    
    # If converted to ZIM format:
    # "https://download.kiwix.org/zim/survival/fm21-76_survival_manual.zim"
    # "https://download.kiwix.org/zim/survival/us_army_survival_guide.zim"
    # "https://download.kiwix.org/zim/survival/sas_survival_handbook.zim"
)

# =============================================================================
# COMBINED CONTENT SOURCES LIST
# =============================================================================

# Main content sources array (customize based on storage and needs)
CONTENT_SOURCES=(
    # Essential Wikipedia (choose size based on storage)
    "https://download.kiwix.org/zim/wikipedia/wikipedia_en_all_nopic_2024-01.zim"       # 20GB no-pics version
    
    # Essential references
    "https://download.kiwix.org/zim/wikivoyage/wikivoyage_en_all_maxi_2024-01.zim"
    "https://download.kiwix.org/zim/wiktionary/wiktionary_en_all_maxi_2024-01.zim"
    "https://download.kiwix.org/zim/wikimed/wikimed_en_all_2024-01.zim"
    
    # Essential books and literature  
    "https://download.kiwix.org/zim/gutenberg/gutenberg_en_selection_2023-08.zim"      # 4GB selection
    
    # Essential technical content
    "https://download.kiwix.org/zim/stack_exchange/stackoverflow.com_en_all_2024-01.zim"
    
    # Essential educational content
    "https://download.kiwix.org/zim/khan-academy/khan-academy_en_2024-01.zim"
    
    # Essential how-to guides
    "https://download.kiwix.org/zim/wikihow/wikihow_en_maxi_2024-01.zim"
)

# =============================================================================
# PDF AND DOCUMENT SOURCES
# =============================================================================

# Directory for non-ZIM content (PDFs, manuals, etc.)
PDF_DATA_DIR="/opt/prepperpi/data/pdfs"
DOCUMENTS_DATA_DIR="/opt/prepperpi/data/documents"

# U.S. Military and Survival Manuals (PDFs)
SURVIVAL_PDF_SOURCES=(
    # U.S. Army Survival Manual
    "https://www.globalsecurity.org/military/library/policy/army/fm/21-76/FM21-76.pdf"
    
    # U.S. Army Field Manuals
    "https://armypubs.army.mil/epubs/DR_pubs/DR_a/pdf/web/ARN30964_FM%203-05.70%20C1%20FINAL%20WEB.pdf"
    
    # USMC Combat Manual  
    "https://www.marines.mil/Portals/1/Publications/MCTP%2011-10B.pdf"
    
    # SAS Survival Handbook (if freely available)
    # Note: Check copyright before including
)

# Medical and Health PDFs
MEDICAL_PDF_SOURCES=(
    # WHO Emergency Medical Manuals
    "https://www.who.int/publications/list-of-emergency-health-kits-and-supplies"
    
    # Red Cross First Aid guides
    "https://www.redcross.org/content/dam/redcross/National/documents/pdf/Take-a-Class/first-aid-steps.pdf"
    
    # CDC Emergency Preparedness guides
    "https://www.cdc.gov/prepyourhealth/toolkit/toolkit.htm"
)

# =============================================================================
# STORAGE AND SIZING CONFIGURATIONS
# =============================================================================

# Storage profiles - uncomment the appropriate one
STORAGE_PROFILE="standard"    # ~64GB SD card
# STORAGE_PROFILE="large"     # ~128GB+ storage  
# STORAGE_PROFILE="minimal"   # ~32GB budget build

# Configure sources based on storage profile
case $STORAGE_PROFILE in
    "minimal")
        # Minimal 32GB build - essential content only
        CONTENT_SOURCES=(
            "https://download.kiwix.org/zim/wikipedia/wikipedia_en_top_2024-01.zim"
            "https://download.kiwix.org/zim/wikimed/wikimed_en_all_2024-01.zim"
            "https://download.kiwix.org/zim/gutenberg/gutenberg_en_selection_2023-08.zim"
            "https://download.kiwix.org/zim/wikihow/wikihow_en_maxi_2024-01.zim"
        )
        ;;
    "standard")
        # Standard 64GB build - balanced content
        CONTENT_SOURCES=(
            "https://download.kiwix.org/zim/wikipedia/wikipedia_en_all_nopic_2024-01.zim"
            "https://download.kiwix.org/zim/wikivoyage/wikivoyage_en_all_maxi_2024-01.zim"
            "https://download.kiwix.org/zim/wiktionary/wiktionary_en_all_maxi_2024-01.zim"
            "https://download.kiwix.org/zim/wikimed/wikimed_en_all_2024-01.zim"
            "https://download.kiwix.org/zim/gutenberg/gutenberg_en_selection_2023-08.zim"
            "https://download.kiwix.org/zim/stack_exchange/stackoverflow.com_en_all_2024-01.zim"
            "https://download.kiwix.org/zim/khan-academy/khan-academy_en_2024-01.zim"
            "https://download.kiwix.org/zim/wikihow/wikihow_en_maxi_2024-01.zim"
        )
        ;;
    "large")
        # Large 128GB+ build - comprehensive content
        CONTENT_SOURCES=(
            "https://download.kiwix.org/zim/wikipedia/wikipedia_en_all_maxi_2024-01.zim"
            "https://download.kiwix.org/zim/wikivoyage/wikivoyage_en_all_maxi_2024-01.zim"
            "https://download.kiwix.org/zim/wiktionary/wiktionary_en_all_maxi_2024-01.zim"
            "https://download.kiwix.org/zim/wikibooks/wikibooks_en_all_maxi_2024-01.zim"
            "https://download.kiwix.org/zim/wikiversity/wikiversity_en_all_maxi_2024-01.zim"
            "https://download.kiwix.org/zim/wikimed/wikimed_en_all_2024-01.zim"
            "https://download.kiwix.org/zim/gutenberg/gutenberg_en_all_2023-08.zim"
            "https://download.kiwix.org/zim/stack_exchange/stackoverflow.com_en_all_2024-01.zim"
            "https://download.kiwix.org/zim/stack_exchange/askubuntu.com_en_all_2024-01.zim"
            "https://download.kiwix.org/zim/stack_exchange/superuser.com_en_all_2024-01.zim"
            "https://download.kiwix.org/zim/khan-academy/khan-academy_en_2024-01.zim"
            "https://download.kiwix.org/zim/ted/ted_en_2024-01.zim"
            "https://download.kiwix.org/zim/wikihow/wikihow_en_maxi_2024-01.zim"
        )
        ;;
esac

# =============================================================================
# DOWNLOAD AND UPDATE SETTINGS
# =============================================================================

# Bandwidth management
DOWNLOAD_LIMIT="1M"           # Limit download speed to avoid overwhelming connection
CONCURRENT_DOWNLOADS=2        # Number of simultaneous downloads
RETRY_ATTEMPTS=3              # Number of retry attempts for failed downloads
TIMEOUT_SECONDS=3600          # Timeout per file (1 hour)

# Update schedule
AUTO_UPDATE=true              # Enable automatic updates
UPDATE_SCHEDULE="monthly"     # How often to check for updates (daily/weekly/monthly)
UPDATE_TIME="02:00"          # Time of day for updates (24-hour format)

# Storage management
ENABLE_COMPRESSION=true       # Compress older ZIM files to save space
MIN_FREE_SPACE="5GB"         # Minimum free space to maintain
AUTO_CLEANUP=true            # Automatically remove old versions when updating

# Notification settings
ENABLE_UPDATE_NOTIFICATIONS=true    # Send notifications about updates
NOTIFICATION_EMAIL=""               # Email for notifications (optional)

# =============================================================================
# ADVANCED CONFIGURATION
# =============================================================================

# Multi-language support
LANGUAGES=("en" "es" "fr" "ar")     # Languages to include (English, Spanish, French, Arabic)

# Content filtering
ENABLE_CONTENT_FILTERING=false      # Filter adult/sensitive content
CONTENT_FILTER_LEVEL="moderate"     # strict/moderate/minimal

# Backup and sync
ENABLE_CONTENT_BACKUP=true          # Backup ZIM files
BACKUP_LOCATION="/opt/prepperpi/backup/content"
ENABLE_P2P_SYNC=false              # Sync with other PrepperPi devices (future feature)

# Performance tuning
KIWIX_THREADS=4                    # Number of server threads
KIWIX_CACHE_SIZE="512M"           # Cache size for Kiwix server
ENABLE_PRELOADING=true            # Preload frequently accessed content

# Security
ENABLE_ACCESS_LOGGING=true        # Log content access
MAX_CONCURRENT_USERS=50          # Maximum simultaneous users
ENABLE_RATE_LIMITING=true        # Prevent abuse

# =============================================================================
# EXPERIMENTAL SOURCES
# =============================================================================

# These sources may not always be available or may require special handling
EXPERIMENTAL_SOURCES=(
    # OpenStreetMap data (requires special handling, not ZIM format)
    # "https://download.openstreetmap.fr/extracts/"
    
    # Internet Archive collections
    # "https://archive.org/download/..."
    
    # Specialized medical databases
    # "https://download.kiwix.org/zim/medical/pubmed_selection_2024-01.zim"
    
    # Government resources  
    # "https://download.kiwix.org/zim/gov/cdc_emergency_guides_2024-01.zim"
    
    # Amateur radio resources (for emergency communications)
    # "https://download.kiwix.org/zim/hamradio/arrl_handbook_2024.zim"
)

# =============================================================================
# CONTENT SOURCE VERIFICATION
# =============================================================================

# Enable content verification
VERIFY_DOWNLOADS=true           # Verify ZIM file integrity after download
CHECK_SIGNATURES=true          # Verify cryptographic signatures if available
QUARANTINE_INVALID=true       # Move invalid files to quarantine directory

# Integrity check settings
INTEGRITY_CHECK_SCHEDULE="weekly"    # How often to verify existing content
AUTO_REPAIR=false                   # Automatically re-download corrupted files

echo "Enhanced Kiwix configuration loaded with comprehensive prepper/survival sources"
echo "Storage profile: $STORAGE_PROFILE"
echo "Total content sources configured: ${#CONTENT_SOURCES[@]}"